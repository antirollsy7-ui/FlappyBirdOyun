<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Flappy Bird Pro - AntiRollsy Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
<style>
    html,body{margin:0;padding:0;overflow:hidden;background:#4ec0ca;font-family: 'Quicksand', sans-serif; user-select: none; font-weight: 700;}
    canvas{display:block;position:absolute;top:0;left:0;z-index:1;}
    
    #nickMenu, #langMenu {
        position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;
        background:rgba(0,0,0,0.9);color:#fff;z-index:200;text-align:center;backdrop-filter: blur(10px);
    }
    #langMenu { display: none; z-index: 210; background:rgba(0,0,0,0.95); }

    #nickInput {
        padding:15px; font-size:20px; border-radius:15px; border:3px solid #f1c40f; margin:20px; 
        width:250px; text-align:center; outline: none; font-family: 'Quicksand', sans-serif; font-weight: 700;
    }

    .lang-opt {
        display:flex; align-items:center; gap:15px; background:rgba(255,255,255,0.1); 
        padding:15px; margin:10px; border-radius:15px; cursor:pointer; width:300px; transition:0.2s;
        border: 2px solid transparent;
    }
    .lang-opt:hover { background:rgba(255,255,255,0.2); border-color: #f1c40f; transform: scale(1.02); }

    #menu, #settingsMenu, #shopMenu {
        position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;
        background:rgba(0,0,0,0.7);color:#fff;z-index:100;text-align:center;backdrop-filter: blur(8px);
    }
    #settingsMenu, #shopMenu { display: none; z-index: 110; }

    .btn {
        padding:12px 25px;font-size:18px;border:none;border-radius:15px;background:#f1c40f;
        color:#2c3e50;font-weight:700;cursor:pointer;transition: 0.2s;
        box-shadow: 0 5px 0 #d4ac0d; margin: 8px; min-width: 120px; font-family: 'Quicksand', sans-serif;
    }
    .btn:hover { background: #f39c12; transform: scale(1.05); }
    .btn:active { transform: translateY(2px); box-shadow: 0 3px 0 #d4ac0d; }
    
    @keyframes rgb-glow {
        0% { background: #ff0000; box-shadow: 0 5px 0 #800000; }
        33% { background: #00ff00; box-shadow: 0 5px 0 #008000; }
        66% { background: #0000ff; box-shadow: 0 5px 0 #000080; }
        100% { background: #ff0000; box-shadow: 0 5px 0 #800000; }
    }
    .credits-btn {
        animation: rgb-glow 2s linear infinite;
        font-family: 'Courier New', Courier, monospace !important;
        color: white !important;
    }

    #creditsOverlay {
        position:absolute; inset:0; display:none; flex-direction:column; align-items:center;
        background:black; color:white; z-index:300; overflow:hidden;
    }
    #creditsContent {
        position:absolute; top:100%; width:100%; text-align:center;
        transition: transform 35s linear;
    }
    .credit-text { font-size:24px; margin:20px 0; line-height:1.8; }
    .close-credits {
        position:absolute; top:20px; right:20px; background:#e74c3c; color:white;
        border:none; border-radius:50%; width:45px; height:45px; font-size:26px;
        cursor:pointer; z-index:310; display:flex; align-items:center; justify-content:center;
        box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
    }

    .reset-btn { background: #e74c3c !important; box-shadow: 0 5px 0 #c0392b !important; color: white !important; margin-top: 20px !important; font-size: 14px !important; }
    .lobby-btn { background: #3498db; box-shadow: 0 5px 0 #2980b9; }

    #ui { position:absolute;top:20px;left:0;right:0;z-index:20; font-size:28px;color:white;text-shadow:2px 2px 4px rgba(0,0,0,0.8); display:flex;flex-direction:column;align-items:flex-start;padding:0 30px;pointer-events: none; }
    #rocketTimerUI { position:absolute; bottom:40px; left:50%; transform: translateX(-50%); background:rgba(231, 76, 60, 0.9); padding:15px 30px; border-radius:50px; color:white; font-size:24px; display:none; z-index:20; border: 4px solid #fff; box-shadow: 0 0 20px rgba(0,0,0,0.3); }
    #hintUI { position: absolute; top: 180px; left: 50%; transform: translateX(-50%); color: #f1c40f; font-size: 22px; text-align: center; z-index: 25; text-shadow: 2px 2px 5px #000; display: none; width: 100%; opacity: 0; }

    @keyframes fadeOutHint { 0% { opacity: 0; transform: translate(-50%, 0px); } 20% { opacity: 1; transform: translate(-50%, -20px); } 80% { opacity: 1; transform: translate(-50%, -20px); } 100% { opacity: 0; transform: translate(-50%, -40px); } }
    .animate-hint { display: block !important; animation: fadeOutHint 4s forwards; }

    .shop-tabs { display: flex; gap: 5px; margin-bottom: 20px; }
    .tab-btn { background: #7f8c8d; min-width: 100px; font-size: 14px; padding: 10px; }
    .tab-active { background: #e67e22 !important; box-shadow: 0 5px 0 #d35400 !important; }
    .shop-item { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.1); margin: 5px; padding: 10px 20px; border-radius: 10px; width: 380px; }
    .setting-row { background:rgba(255,255,255,0.1); padding:15px; border-radius:15px; width: 320px; margin-bottom: 10px; }
    #healthUI { font-size: 32px; margin-top: 5px; }
</style>
</head>
<body>

<canvas id="game"></canvas>

<audio id="bgMusic" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" type="audio/mpeg">
</audio>

<div id="nickMenu" style="display:none">
    <h1 style="font-size: 40px; text-shadow: 3px 3px 0 #d4ac0d;">HO≈û GELDƒ∞N!</h1>
    <p>L√ºtfen bir lakap (nick) girin:</p>
    <input type="text" id="nickInput" placeholder="Nickiniz..." maxlength="12">
    <button id="nickSaveBtn" class="btn">KAYDET</button>
</div>

<div id="langMenu">
    <h2 style="margin-bottom: 30px;">Dƒ∞L SE√áƒ∞N / SELECT LANGUAGE</h2>
    <div class="lang-opt" onclick="finishSetup()">
        <span style="font-size:35px">üáπüá∑</span>
        <div style="text-align:left">
            <div style="font-size:20px">T√ºrk√ße</div>
            <div style="font-size:12px; color:#aaa">Varsayƒ±lan Dil</div>
        </div>
    </div>
    <div class="lang-opt" onclick="alert('Tek ki≈üilik projede dil desteƒüi beklemek mi? G√ºld√ºrme beni :D')">
        <span style="font-size:35px">üåê</span>
        <div style="text-align:left">
            <div style="font-size:20px">English / Other</div>
            <div style="font-size:12px; color:#aaa">Coming Soon ‚û°Ô∏è</div>
        </div>
    </div>
</div>

<div id="hintUI">ƒ∞pucu: 60, 120 ve katlarƒ±nda 1000üí∞ kazanƒ±rsƒ±n!</div>
<div id="rocketTimerUI">üöÄ ROKET: <span id="rTime">20.0</span>s</div>

<div id="creditsOverlay">
    <button id="creditsCloseBtn" class="close-credits">‚úñ</button>
    <div id="creditsContent">
        <div class="credit-text">
            <br><br><br>
            <h1 style="color:#f1c40f; font-size: 45px;">MADEM MERAK ETTƒ∞N:</h1><br>
            <p>Y√∂netmen: <span style="color:#2ecc71">AntiRollsy</span></p>
            <p>Yapƒ±mcƒ±: <span style="color:#2ecc71">AntiRollsy</span></p>
            <p>Kodlama & Yazƒ±lƒ±m: <span style="color:#2ecc71">AntiRollsy</span></p>
            <p>G√∂rsel Efektler: <span style="color:#2ecc71">AntiRollsy</span></p>
            <p>Ses Efekt Tasarƒ±mƒ±: <span style="color:#2ecc71">AntiRollsy</span></p>
            <p>Arka Plan Tasarƒ±mƒ±: <span style="color:#2ecc71">AntiRollsy</span></p>
            <p>Oyun Fikri: <span style="color:#2ecc71">AntiRollsy</span></p>
            <p>Yapƒ±m S√ºresi: <span style="color:#e67e22">+48 Saat</span></p><br><br>
            <p style="font-size: 32px;">Oyun bitince ne oluyor?<br><b style="color:#e74c3c; font-size: 42px;">OYUN Bƒ∞TMƒ∞YORKƒ∞ AMK!</b></p><br>
            <p>Sadece eƒülenmene bak dostum.</p>
            <br><br><br><br><br>
        </div>
    </div>
</div>

<div id="menu">
    <div id="mainButtons">
        <h1 style="font-size: 50px; margin: 0; text-shadow: 3px 3px 0 #000;">FLAPPY BIRD</h1>
        <p id="highScoreDisplay" style="color: #2ecc71; font-size: 20px; margin: 5px 0;">En Y√ºksek Skor: 0</p>
        <p id="totalGoldDisplay" style="font-size: 24px; margin-bottom: 10px;">üí∞ 0</p>
        <button id="playBtn" class="btn">OYNA</button>
        <button id="shopOpenBtn" class="btn" style="background: #e67e22; box-shadow: 0 5px 0 #d35400;">MAƒûAZA</button>
        <button id="setOpenBtn" class="btn" style="background: #95a5a6; box-shadow: 0 5px 0 #7f8c8d;">AYARLAR</button>
        <button id="creditsOpenBtn" class="btn credits-btn">YAPIMCILAR</button>
    </div>
    <div id="deathScreen" style="display:none">
        <h1 style="color:#e74c3c; margin:0;">EYVAH √ñLD√úN!</h1>
        <p id="sessionResult" style="font-size:20px; margin:5px;"></p>
        <button id="retryBtn" class="btn">TEKRAR DENE</button>
        <button id="lobbyBtn" class="btn lobby-btn">LOBƒ∞YE D√ñN</button>
    </div>
</div>

<div id="shopMenu">
    <h2>MAƒûAZA</h2>
    <div class="shop-tabs">
        <button id="tabColors" class="btn tab-btn tab-active">RENKLER</button>
        <button id="tabItems" class="btn tab-btn">E≈ûYALAR</button>
        <button id="tabAccs" class="btn tab-btn">AKSESUAR</button>
    </div>
    <p id="shopGold" style="color:#f1c40f; margin-top:0;">üí∞ 0</p>
    <div id="shopContent" style="min-height: 250px; display: flex; flex-direction: column; align-items: center;"></div>
    <button id="shopCloseBtn" class="btn lobby-btn">GERƒ∞ D√ñN</button>
</div>

<div id="settingsMenu">
    <h2>AYARLAR</h2>
    <div class="setting-row">
        <p>Yer√ßekimi: <span id="gravVal">0.35</span></p>
        <input type="range" id="gravSlider" min="0.10" max="1.00" step="0.05" value="0.35" style="width:100%">
    </div>
    <div class="setting-row">
        <p>Zƒ±plama Boyutu: <span id="jumpVal">9.0</span></p>
        <input type="range" id="jumpSlider" min="5.0" max="15.0" step="0.5" value="9.0" style="width:100%">
    </div>
    <div class="setting-row">
        <p>Ba≈ülangƒ±√ß Hƒ±zƒ±: <span id="speedVal">4</span></p>
        <input type="range" id="speedSlider" min="3" max="8" step="0.5" value="4" style="width:100%">
    </div>
    <div class="setting-row">
        <p>M√ºzik: <button id="musicToggleBtn" class="btn" style="min-width:60px; padding:5px 10px; margin:0">A√áIK</button></p>
    </div>
    <button id="resetAccountBtn" class="btn reset-btn">HESABI SIFIRLA</button>
    <button id="setCloseBtn" class="btn" style="margin-top: 10px;">GERƒ∞</button>
</div>

<div id="ui">
    <div style="display:flex; gap: 20px; align-items: center;">
        <span id="score">Skor: 0</span>
        <span id="gold">üí∞ 0</span>
    </div>
    <div id="healthUI"></div>
</div>

<script>
const canvas = document.getElementById("game"), ctx = canvas.getContext("2d");
const menu = document.getElementById("menu"), settingsMenu = document.getElementById("settingsMenu"), shopMenu = document.getElementById("shopMenu");
const nickMenu = document.getElementById("nickMenu"), langMenu = document.getElementById("langMenu"), nickInput = document.getElementById("nickInput");
const mainButtons = document.getElementById("mainButtons"), deathScreen = document.getElementById("deathScreen");
const rocketUI = document.getElementById("rocketTimerUI"), rTimeText = document.getElementById("rTime");
const hintUI = document.getElementById("hintUI"), bgMusic = document.getElementById("bgMusic");
const healthUI = document.getElementById("healthUI");
const creditsOverlay = document.getElementById("creditsOverlay"), creditsContent = document.getElementById("creditsContent");

bgMusic.volume = 0.3; 

let playerNick = localStorage.getItem("playerNick") || "";
let setupComplete = localStorage.getItem("setupComplete") === "true";
let state = "menu", score = 0, frame = 0, sessionGold = 0;
let totalGold = parseInt(localStorage.getItem("totalGold")) || 0;
let highScore = parseInt(localStorage.getItem("highScore")) || 0;

let gravity = 0.35; 
let jumpPower = -9; 
let baseSpeed = 4; 
let speed = 4;

let musicEnabled = localStorage.getItem("musicEnabled") === "false" ? false : true;
let birdColor = localStorage.getItem("birdColor") || "#f5c400";
let ownedColors = JSON.parse(localStorage.getItem("ownedColors")) || ["#f5c400"];
let currentAcc = localStorage.getItem("currentAcc") || "none";
let ownedAccs = JSON.parse(localStorage.getItem("ownedAccs")) || ["none"];

let hasRocket = false, hasUltraRocket = false;
let hasLifePotion = localStorage.getItem("hasLifePotion") === "true"; 
let currentLives = 1;
let currentTab = "colors";

let rocketActive = false, rocketTime = 0, safeMode = false, safeTimer = 0;
const bird = { x: 120, y: 300, vy: 0 };
let pipes = [], particles = [], clouds = [], mountains = [];
const gap = 185;

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let rocketSoundSource = null;

function playSound(type) {
    const now = audioCtx.currentTime;
    if (type === 'jump') {
        const o = audioCtx.createOscillator(), g = audioCtx.createGain();
        o.connect(g); g.connect(audioCtx.destination);
        o.frequency.setValueAtTime(350, now);
        o.frequency.exponentialRampToValueAtTime(550, now + 0.1);
        g.gain.setValueAtTime(0.1, now);
        g.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
        o.start(); o.stop(now + 0.1);
    } else if (type === 'coin') {
        const o = audioCtx.createOscillator(), g = audioCtx.createGain();
        o.connect(g); g.connect(audioCtx.destination);
        o.frequency.setValueAtTime(950, now);
        o.frequency.setValueAtTime(1300, now + 0.08);
        g.gain.setValueAtTime(0.2, now);
        g.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
        o.start(); o.stop(now + 0.3);
    } else if (type === 'hit') {
        const o = audioCtx.createOscillator(), g = audioCtx.createGain();
        o.connect(g); g.connect(audioCtx.destination);
        o.type = 'square'; o.frequency.setValueAtTime(150, now);
        g.gain.setValueAtTime(0.1, now); g.gain.linearRampToValueAtTime(0, now + 0.2);
        o.start(); o.stop(now + 0.2);
    } else if (type === 'gameover') {
        const o = audioCtx.createOscillator(), g = audioCtx.createGain();
        o.connect(g); g.connect(audioCtx.destination);
        o.type = 'sawtooth'; o.frequency.setValueAtTime(200, now);
        o.frequency.linearRampToValueAtTime(50, now + 0.6);
        g.gain.setValueAtTime(0.2, now); g.gain.linearRampToValueAtTime(0, now + 0.6);
        o.start(); o.stop(now + 0.6);
    } else if (type === 'rocket_start') {
        const bufferSize = audioCtx.sampleRate * 2;
        const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) { data[i] = Math.random() * 2 - 1; }
        rocketSoundSource = audioCtx.createBufferSource();
        rocketSoundSource.buffer = buffer; rocketSoundSource.loop = true;
        const g = audioCtx.createGain(); const filter = audioCtx.createBiquadFilter();
        filter.type = 'lowpass'; filter.frequency.value = 600;
        rocketSoundSource.connect(filter); filter.connect(g); g.connect(audioCtx.destination);
        g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(0.15, now + 0.5);
        rocketSoundSource.gainNode = g; rocketSoundSource.start();
    } else if (type === 'rocket_stop') {
        if (rocketSoundSource) {
            const g = rocketSoundSource.gainNode;
            g.gain.linearRampToValueAtTime(0, now + 0.3);
            setTimeout(() => { try { rocketSoundSource.stop(); } catch(e){} rocketSoundSource = null; }, 300);
        }
    }
}

function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; initBG(); }
window.onresize = resize; resize();

function initBG() {
    clouds = []; mountains = [];
    for(let i=0; i<6; i++) clouds.push({x: Math.random()*canvas.width, y: Math.random()*200, s: Math.random()*0.3+0.1});
    for(let i=0; i<5; i++) mountains.push({x: i*450, h: 120 + Math.random()*150, w: 300 + Math.random()*100});
}

function updateMusic() {
    if(musicEnabled) { bgMusic.play().catch(() => {}); document.getElementById("musicToggleBtn").innerText = "A√áIK"; } 
    else { bgMusic.pause(); document.getElementById("musicToggleBtn").innerText = "KAPALI"; }
}

function spawnConfetti() {
    for(let i=0; i<80; i++) {
        particles.push({ x: canvas.width/2, y: canvas.height/2, vx: Math.random()*16-8, vy: Math.random()*16-8, c: `hsl(${Math.random()*360}, 100%, 50%)`, life: 100, size: Math.random()*6+2 });
    }
}

function resetGame() {
    state = "play"; score = 0; sessionGold = 0; frame = 0; bird.y = canvas.height / 2; bird.vy = 0; pipes = []; particles = []; 
    speed = baseSpeed;
    menu.style.display = "none";
    hintUI.classList.remove("animate-hint");
    void hintUI.offsetWidth;
    hintUI.classList.add("animate-hint");
    if(musicEnabled) bgMusic.play();
    
    currentLives = hasLifePotion ? 2 : 1;

    if (hasUltraRocket) {
        rocketActive = true; rocketTime = 40 * 60; speed = 25; 
        rocketUI.style.display = "block"; hasUltraRocket = false;
        playSound('rocket_start');
    } else if (hasRocket) { 
        rocketActive = true; rocketTime = 20 * 60; speed = 22; 
        rocketUI.style.display = "block"; hasRocket = false; 
        playSound('rocket_start');
    } else { rocketActive = false; rocketUI.style.display = "none"; }
    updateUI();
}

function update() {
    if (state !== "play") return;
    frame++;

    if (!rocketActive && frame % 300 === 0) { speed += 0.15; }

    let spawnInterval = rocketActive ? 25 : Math.max(70, 110 - (speed * 5));
    
    if (!safeMode && frame % Math.floor(spawnInterval) === 0) {
        pipes.push({ x: canvas.width, y: Math.random()*(canvas.height-380)+80, scored: false });
    }
    
    if (rocketActive) {
        rocketTime--; rTimeText.innerText = (rocketTime / 60).toFixed(1);
        bird.y += (canvas.height/2 - bird.y) * 0.15; bird.vy = 0;
        if (rocketTime <= 0) { 
            rocketActive = false; speed = baseSpeed + (score * 0.03); 
            rocketUI.style.display = "none"; safeMode = true; safeTimer = 180; spawnConfetti(); 
            playSound('rocket_stop');
        }
    } else { bird.vy += gravity; bird.y += bird.vy; }

    if (safeMode) { safeTimer--; if(safeTimer <= 0) safeMode = false; }
    
    pipes.forEach((p, index) => {
        p.x -= speed;
        if (bird.x + 18 > p.x && bird.x - 18 < p.x + 80 && (bird.y - 14 < p.y || bird.y + 14 > p.y + gap)) {
            if (rocketActive) { pipes.splice(index, 1); score++; checkMilestones(); } 
            else if (!safeMode) takeDamage();
        }
        if (p.x + 80 < bird.x && !p.scored) { p.scored = true; score++; checkMilestones(); }
    });
    
    for(let i=particles.length-1; i>=0; i--) { let p = particles[i]; p.x += p.vx; p.y += p.vy; p.life--; if(p.life <= 0) particles.splice(i, 1); }
    if (bird.y > canvas.height - 40 || bird.y < 0) { if(!rocketActive && !safeMode) takeDamage(); }
}

function takeDamage() {
    currentLives--; updateUI();
    if(currentLives <= 0) { gameOver(); } 
    else {
        playSound('hit'); safeMode = true; safeTimer = 90; bird.vy = -8; 
        for(let i=0; i<15; i++) particles.push({ x: bird.x, y: bird.y, vx: Math.random()*10-5, vy: Math.random()*10-5, c: "red", life: 30, size: 4 });
    }
}

function checkMilestones() {
    if(score > 0 && score % 60 === 0) { sessionGold += 1000; totalGold += 1000; saveData(); spawnConfetti(); playSound('coin'); } 
    else if(score > 0 && score % 10 === 0) { sessionGold += 50; totalGold += 50; saveData(); playSound('coin'); }
    updateUI();
}

function drawBird() {
    ctx.save(); ctx.translate(bird.x, bird.y);
    if (rocketActive) {
        ctx.fillStyle = "#95a5a6"; ctx.beginPath(); ctx.roundRect(-50, -8, 45, 16, 4); ctx.fill(); ctx.stroke();
        ctx.fillStyle = "#e74c3c"; ctx.beginPath(); ctx.moveTo(-5, -8); ctx.lineTo(10, 0); ctx.lineTo(-5, 8); ctx.fill();
        ctx.fillStyle = "#34495e"; ctx.fillRect(-55, -5, 8, 10);
        let fireW = 25 + Math.random()*30;
        let grad = ctx.createLinearGradient(-55, 0, -55-fireW, 0);
        grad.addColorStop(0, "#ff0000"); grad.addColorStop(0.4, "#ff9900"); grad.addColorStop(1, "transparent");
        ctx.fillStyle = grad; ctx.beginPath(); ctx.moveTo(-55, -6); ctx.lineTo(-55-fireW, 0); ctx.lineTo(-55, 6); ctx.fill();
    }
    if (safeMode && frame % 10 < 5) ctx.globalAlpha = 0.3;
    ctx.rotate(rocketActive ? 0 : Math.max(-0.4, Math.min(0.4, bird.vy / 20)));
    ctx.fillStyle = birdColor; ctx.strokeStyle = "black"; ctx.lineWidth = 2.5; ctx.beginPath(); ctx.ellipse(0, 0, 20, 16, 0, 0, Math.PI * 2); ctx.fill(); ctx.stroke();
    if(currentAcc === "bjk") {
        ctx.save(); ctx.fillStyle = "white"; ctx.beginPath(); ctx.ellipse(0, 5, 16, 11, 0, 0, Math.PI * 2); ctx.fill(); ctx.clip();
        ctx.fillStyle = "black"; for(let i = -20; i < 20; i += 10) { ctx.fillRect(i, -10, 5, 30); } ctx.restore();
        ctx.strokeStyle = "black"; ctx.lineWidth = 1; ctx.beginPath(); ctx.ellipse(0, 5, 16, 11, 0, 0, Math.PI * 2); ctx.stroke();
    }
    ctx.fillStyle = "white"; ctx.beginPath(); ctx.ellipse(-8, 3, 11, 8, (rocketActive ? 0 : Math.sin(frame*0.2)*0.6), 0, Math.PI * 2); ctx.fill(); ctx.stroke();
    ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(10, -6, 7, 0, Math.PI * 2); ctx.fill(); ctx.stroke();
    ctx.fillStyle = "black"; ctx.beginPath(); ctx.arc(12, -6, 3, 0, Math.PI * 2); ctx.fill();
    ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(13, -7.5, 1.2, 0, Math.PI * 2); ctx.fill();
    ctx.fillStyle = "#ff7f00"; ctx.beginPath(); ctx.moveTo(16, -2); ctx.quadraticCurveTo(28, 3, 16, 9); ctx.closePath(); ctx.fill(); ctx.stroke();
    ctx.restore();
    ctx.save(); ctx.translate(bird.x, bird.y); ctx.fillStyle = "white"; ctx.font = "bold 14px 'Quicksand'"; ctx.textAlign = "center"; ctx.strokeStyle = "black"; ctx.lineWidth = 3; ctx.strokeText(playerNick, 0, -30); ctx.fillText(playerNick, 0, -30); ctx.restore();
}

function drawPipes() {
    pipes.forEach(p => {
        let grad = ctx.createLinearGradient(p.x, 0, p.x + 80, 0);
        grad.addColorStop(0, "#73bf2e"); grad.addColorStop(0.5, "#9de64e"); grad.addColorStop(1, "#558022");
        ctx.fillStyle = grad; ctx.strokeStyle = "black"; ctx.lineWidth = 3;
        ctx.fillRect(p.x, 0, 80, p.y); ctx.strokeRect(p.x, 0, 80, p.y);
        ctx.fillRect(p.x, p.y + gap, 80, canvas.height); ctx.strokeRect(p.x, p.y + gap, 80, canvas.height);
        ctx.fillRect(p.x - 5, p.y - 25, 90, 25); ctx.strokeRect(p.x - 5, p.y - 25, 90, 25);
        ctx.fillRect(p.x - 5, p.y + gap, 90, 25); ctx.strokeRect(p.x - 5, p.y + gap, 90, 25);
    });
}

function drawBG() {
    ctx.fillStyle = "#70c5ce"; ctx.fillRect(0, 0, canvas.width, canvas.height);
    mountains.forEach(m => {
        ctx.fillStyle = "#4db3a4"; ctx.beginPath(); ctx.moveTo(m.x, canvas.height-40); ctx.lineTo(m.x+m.w/2, canvas.height-40-m.h); ctx.lineTo(m.x+m.w, canvas.height-40); ctx.fill();
        ctx.fillStyle = "#3e8e82"; ctx.beginPath(); ctx.moveTo(m.x+m.w/2, canvas.height-40-m.h); ctx.lineTo(m.x+m.w, canvas.height-40); ctx.lineTo(m.x+m.w/2, canvas.height-40); ctx.fill();
    });
    clouds.forEach(c => {
        c.x -= (c.s * (speed/baseSpeed)); if(c.x < -150) c.x = canvas.width + 150;
        ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(c.x, c.y, 20, 0, Math.PI*2); ctx.arc(c.x+15, c.y-10, 25, 0, Math.PI*2); ctx.arc(c.x+30, c.y, 20, 0, Math.PI*2); ctx.fill();
    });
    ctx.fillStyle = "#ded895"; ctx.fillRect(0, canvas.height-40, canvas.width, 40);
}

function loop() { ctx.clearRect(0, 0, canvas.width, canvas.height); drawBG(); drawPipes(); particles.forEach(p => { ctx.fillStyle = p.c; ctx.fillRect(p.x, p.y, p.size, p.size); }); drawBird(); update(); requestAnimationFrame(loop); }

function gameOver() {
    state = "dead"; playSound('gameover'); playSound('rocket_stop');
    if(score > highScore) { highScore = score; localStorage.setItem("highScore", highScore); }
    rocketActive = false; rocketUI.style.display = "none"; hintUI.classList.remove("animate-hint");
    mainButtons.style.display = "none"; deathScreen.style.display = "block";
    document.getElementById("sessionResult").innerText = `Skor: ${score} | Toplam Altƒ±n: üí∞${totalGold}`;
    menu.style.display = "flex"; bgMusic.pause(); bgMusic.currentTime = 0;
}

function updateUI() {
    document.getElementById("score").textContent = "Skor: " + score;
    document.getElementById("gold").textContent = "üí∞ " + sessionGold;
    document.getElementById("totalGoldDisplay").textContent = "üí∞ " + totalGold;
    document.getElementById("highScoreDisplay").textContent = "En Y√ºksek Skor: " + highScore;
    let hearts = ""; for(let i=0; i<currentLives; i++) hearts += "‚ù§Ô∏è"; healthUI.innerText = hearts;
}

function renderShop() {
    const content = document.getElementById("shopContent"); content.innerHTML = ""; document.getElementById("shopGold").innerText = "C√ºzdan: üí∞ " + totalGold;
    if (currentTab === "colors") {
        const colors = [{ n: "Klasik", c: "#f5c400", p: 0 }, { n: "Mavi", c: "#3498db", p: 100 }, { n: "Kƒ±rmƒ±zƒ±", c: "#e74c3c", p: 250 }, { n: "Mor", c: "#9b59b6", p: 500 }];
        colors.forEach(item => {
            let isOwned = ownedColors.includes(item.c);
            let btnText = isOwned ? (birdColor === item.c ? "SE√áƒ∞LDƒ∞" : "SE√á") : `üí∞ ${item.p}`;
            content.innerHTML += `<div class="shop-item"><div style="background:${item.c}; border:2px solid #fff; border-radius:50%; width:20px; height:20px;"></div><span>${item.n}</span><button onclick="buyColor('${item.c}', ${item.p})" class="btn" style="min-width:80px; font-size:14px;">${btnText}</button></div>`;
        });
    } else if (currentTab === "items") {
        content.innerHTML = `
            <div class="shop-item" style="height:70px">
                <div style="font-size:25px">üöÄ</div>
                <div style="font-size:11px; text-align:left; max-width:180px"><b>ROKET:</b> 20 sn u√ßar!</div>
                <button onclick="buyRocket()" class="btn" style="min-width:90px; background:#e74c3c">${hasRocket ? "HAZIR" : "500üí∞"}</button>
            </div>
            <div class="shop-item" style="height:70px">
                <div style="font-size:25px">üî•</div>
                <div style="font-size:11px; text-align:left; max-width:180px"><b>ULTRA ROKET:</b> 40 sn u√ßar!</div>
                <button onclick="buyUltraRocket()" class="btn" style="min-width:90px; background:#c0392b">${hasUltraRocket ? "HAZIR" : "1000üí∞"}</button>
            </div>
            <div class="shop-item" style="height:70px">
                <div style="font-size:25px">üß™</div>
                <div style="font-size:11px; text-align:left; max-width:180px"><b>CAN ƒ∞KSƒ∞Rƒ∞:</b> Tek seferlik √∂lmezsiniz, kalƒ±cƒ± e≈üya!</div>
                <button onclick="buyLifePotion()" class="btn" style="min-width:90px; background:#27ae60">${hasLifePotion ? "ALINDI" : "3000üí∞"}</button>
            </div>`;
    } else if (currentTab === "accs") {
        const accs = [{ id: "none", n: "Yok", p: 0 }, { id: "bjk", n: "Be≈üikta≈ü Formasƒ±", p: 5000 }];
        accs.forEach(item => {
            let isOwned = ownedAccs.includes(item.id);
            let btnText = isOwned ? (currentAcc === item.id ? "Gƒ∞Yƒ∞LDƒ∞" : "Gƒ∞Y") : `üí∞ ${item.p}`;
            content.innerHTML += `<div class="shop-item"><div style="font-size:20px">${item.id === 'bjk' ? 'üëï' : '‚ùå'}</div><span>${item.n}</span><button onclick="buyAcc('${item.id}', ${item.p})" class="btn" style="min-width:80px; font-size:14px;">${btnText}</button></div>`;
        });
    }
}

function buyColor(c, p) { if (ownedColors.includes(c)) birdColor = c; else if (totalGold >= p) { totalGold -= p; ownedColors.push(c); birdColor = c; playSound('coin'); } saveData(); renderShop(); updateUI(); }
function buyRocket() { if (!hasRocket && !hasUltraRocket && totalGold >= 500) { totalGold -= 500; hasRocket = true; saveData(); renderShop(); updateUI(); playSound('coin'); } }
function buyUltraRocket() { if (!hasUltraRocket && !hasRocket && totalGold >= 1000) { totalGold -= 1000; hasUltraRocket = true; saveData(); renderShop(); updateUI(); playSound('coin'); } }
function buyLifePotion() { if (!hasLifePotion && totalGold >= 3000) { totalGold -= 3000; hasLifePotion = true; saveData(); renderShop(); updateUI(); playSound('coin'); } }
function buyAcc(id, p) { if (ownedAccs.includes(id)) currentAcc = id; else if (totalGold >= p) { totalGold -= p; ownedAccs.push(id); currentAcc = id; playSound('coin'); } saveData(); renderShop(); updateUI(); }

function saveData() { 
    localStorage.setItem("totalGold", totalGold); localStorage.setItem("ownedColors", JSON.stringify(ownedColors)); localStorage.setItem("birdColor", birdColor);
    localStorage.setItem("currentAcc", currentAcc); localStorage.setItem("ownedAccs", JSON.stringify(ownedAccs)); localStorage.setItem("musicEnabled", musicEnabled);
    localStorage.setItem("hasLifePotion", hasLifePotion); localStorage.setItem("setupComplete", "true");
}

function checkInit() {
    if (!playerNick) { nickMenu.style.display = "flex"; menu.style.display = "none"; } 
    else if (!setupComplete) { langMenu.style.display = "flex"; menu.style.display = "none"; }
}

function finishSetup() { langMenu.style.display = "none"; menu.style.display = "flex"; setupComplete = true; saveData(); }

document.getElementById("nickSaveBtn").onclick = () => {
    const val = nickInput.value.trim();
    if (val.length >= 2) { playerNick = val; localStorage.setItem("playerNick", playerNick); nickMenu.style.display = "none"; langMenu.style.display = "flex"; } 
    else { alert("L√ºtfen en az 2 karakterli bir nick girin!"); }
};

document.getElementById("creditsOpenBtn").onclick = () => {
    creditsOverlay.style.display = "flex"; creditsContent.style.transition = "none"; creditsContent.style.transform = "translateY(0)";
    setTimeout(() => {
        creditsContent.style.transition = "transform 35s linear";
        const distance = window.innerHeight + creditsContent.offsetHeight;
        creditsContent.style.transform = `translateY(-${distance + 500}px)`;
    }, 100);
};

document.getElementById("creditsCloseBtn").onclick = () => { creditsOverlay.style.display = "none"; creditsContent.style.transition = "none"; creditsContent.style.transform = "translateY(0)"; };
document.getElementById("resetAccountBtn").onclick = () => { if (confirm("T√ºm altƒ±nlarƒ±n ve skorlarƒ±n silinecek. Emin misin?")) { localStorage.clear(); location.reload(); } };
document.getElementById("playBtn").onclick = resetGame;
document.getElementById("retryBtn").onclick = resetGame;
document.getElementById("lobbyBtn").onclick = () => { state = "menu"; deathScreen.style.display = "none"; mainButtons.style.display = "block"; updateUI(); };
document.getElementById("shopOpenBtn").onclick = () => { shopMenu.style.display = "flex"; renderShop(); };
document.getElementById("shopCloseBtn").onclick = () => shopMenu.style.display = "none";
document.getElementById("setOpenBtn").onclick = () => { settingsMenu.style.display = "flex"; updateMusic(); };
document.getElementById("setCloseBtn").onclick = () => settingsMenu.style.display = "none";
document.getElementById("tabColors").onclick = function() { currentTab = "colors"; switchTab(this); };
document.getElementById("tabItems").onclick = function() { currentTab = "items"; switchTab(this); };
document.getElementById("tabAccs").onclick = function() { currentTab = "accs"; switchTab(this); };
function switchTab(el) { document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('tab-active')); el.classList.add('tab-active'); renderShop(); }

document.getElementById("gravSlider").oninput = function() { gravity = parseFloat(this.value); document.getElementById("gravVal").innerText = this.value; };
document.getElementById("jumpSlider").oninput = function() { jumpPower = -parseFloat(this.value); document.getElementById("jumpVal").innerText = parseFloat(this.value).toFixed(1); };
document.getElementById("speedSlider").oninput = function() { baseSpeed = parseFloat(this.value); speed = baseSpeed; document.getElementById("speedVal").innerText = this.value; };
document.getElementById("musicToggleBtn").onclick = function() { musicEnabled = !musicEnabled; updateMusic(); saveData(); };

const jump = () => { if(state === "play" && !rocketActive) { bird.vy = jumpPower; playSound('jump'); } };
window.onkeydown = (e) => { if(e.code === "Space") jump(); };
canvas.onmousedown = jump;

checkInit();
updateUI(); updateMusic(); loop();
</script>
</body>
</html>
